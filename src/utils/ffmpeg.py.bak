import subprocess, os, json, shlex

def run(cmd):
    print("[ffmpeg] $", cmd)
    proc = subprocess.run(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
    if proc.returncode != 0:
        print(proc.stdout)
        print(proc.stderr)
        raise RuntimeError(f"ffmpeg error: {proc.stderr[:3000]}")
    return proc

def probe_duration(path):
    cmd = f'ffprobe -v error -show_entries format=duration -of default=nk=1:nw=1 "{path}"'
    proc = subprocess.run(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
    if proc.returncode != 0:
        return 0.0
    try:
        return float(proc.stdout.strip())
    except:
        return 0.0
